<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cheque List Viewer for BISE BANNU">
    <title>A/c test BISEB</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles/style.css">

    <style>
        /* Add your custom styles here */
        .status-green { color: #28a745; font-weight: 500; }
        .status-red { color: #dc3545; font-weight: 500; }
        .status-blue { color: #007bff; font-weight: 500; }
        .status-gray { color: #6c757d; font-weight: 500; }
        .status-orange { color: #fd7e14; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>Accounts Section: BISE Bannu Office</h1>
            <p class="text-muted">Check Information and Updates</p>
        </div>

        <!-- Search Section -->
        <div class="search-container d-flex flex-column flex-md-row align-items-center gap-3">
            <div class="input-group flex-grow-1">
                <input type="search" id="search" class="form-control" placeholder="Search..." aria-label="Search CHQS">
            </div>
            <div class="d-flex align-items-center gap-2 flex-grow-1">
                <select class="form-select flex-grow-1" id="narCategory">
                   <option value="all" selected>Search All Bills</option>
                    <option value="TA/DA TO SUPERVISORY STAFF SSC EXAM:">Supervisory Staff SSC</option>
                    <option value="TA/DA TO SUPERVISORY STAFF HSSC EXAM:">Supervisory Staff HSSC</option>
                    <option value="TA/DA TO PRACTICAL EXMR: SSC">Practical Staff SSC</option>
                    <option value="TA/DA TO PRACTICAL EXMR: HSSC">Practical Staff HSSC</option>
                    <option value="TA/DA TO INSEPCTORS SSC">Inspections Staff SSC</option>
                    <option value="TA/DA TO INSEPCTORS HSSC">Inspections Staf HSSC</option>
                    <option value="REMUNERATION RES: INSPECTORS">Resedent Inspectors</option>
                    <option value="LABORATORY CHARGES">Laboratory Charges</option>
                    <option value="TA/DA GENERAL">TA/DA General</option>
                    
                    <option value="MARKING SSC">Marking SSC</option>
                    <option value="MARKING HSSC">Marking HSSC</option>
                    <option value="REMUNERATION TO PAPER SETTER HSSC">Remuneration to Paper Setter HSSC</option>
                    <option value="REMUNERATION TO UFM MEMEBERS">Remuneration to UFM Members</option>
                    
                    <option value="EXPIRED CHECK RENEWED">Expired Check Renewed</option>
                    <option value="HONORARIA">Honoraria</option>
                    <option value="REFUND OF FEE">Refund of Fee</option>
                    <option value="RETOTALLING">Retotalling</option>
                    <!-- Add other NAR options here -->
                    <!-- Add other NAR options here -->
                </select>
                <button class="btn btn-primary" type="button" id="searchBtn">
                    <i class="fas fa-search"></i> Search
                </button>
                <select class="form-select flex-grow-1" id="statusFilter">
                    <option value="all" selected>All Statuses</option>
                    <option value="despatched through gpo">Despatched through GPO</option>
                    <option value="ready but not signed yet">Ready but not signed yet</option>
                    <option value="cheque ready">Cheque Ready</option>
                    <option value="despatched to lakki camp office">Despatched to Lakki Camp Office</option>
                    <option value="sent to chairman sb. for sign">Sent to Chairman SB for Sign</option>
                </select>
            </div>
        </div>

        <!-- Result Section -->
        <div id="result" class="alert alert-info" role="alert" style="display: none;"></div>
        <div class="table-responsive" id="tableContainer" style="display: none;">
            <table class="table table-hover" id="chequeTable">
                <thead>
                    <tr>
                        <th data-column="NARRATION">Payee(s) Name and Address <span class="sort-icon"></span></th>
                        <th data-column="AMOUNT">Amount <span class="sort-icon"></span></th>
                        <th data-column="CHEQ_NO">Cheque No <span class="sort-icon"></span></th>
                        <th data-column="NAR">In Care Of <span class="sort-icon"></span></th>
                        <th data-column="DD">Details Status <span class="sort-icon"></span></th>
                    </tr>
                </thead>
                <tbody id="checksTable"></tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav aria-label="Table pagination" id="pagination">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled" id="prevPage">
                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                </li>
                <li class="page-item active" id="page1">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item" id="nextPage">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState">
            <i class="fas fa-search"></i>
            <p class="lead">Enter the name or school name to view search results</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
       /**
 * XMLTableHandler: Enhanced class for XML data handling and table management
 * Version: 5.1
 * Debug Mode: Enabled
 * Last Updated: 2025-02-16
 * 
 * FIXES:
 * 1. Corrected pagination element ID from 'paginationContainer' to 'pagination'
 * 2. Added proper error handling for all operations
 * 3. Enhanced logging for debugging
 * 4. Fixed table visibility issues
 * 5. Improved event listener management
 */
class XMLTableHandler {
    constructor() {
        console.log('üöÄ Initializing XMLTableHandler...');
        
        try {
            this.initializeDOMElements();
            this.defineColumns();
            this.initializeState();
            this.initializeEventListeners();
            
            console.log('‚úÖ XMLTableHandler initialization successful');
        } catch (error) {
            console.error('‚ùå Constructor Error:', error);
            this.showError('Failed to initialize table handler');
        }
    }

    /**
     * Initialize and validate all required DOM elements
     */
    initializeDOMElements() {
        console.log('üîç Validating DOM elements...');
        
        // Corrected element mapping
        const required_elements = {
            'checksTable': 'tableBody',
            'search': 'searchInput',
            'narCategory': 'narFilter',
            'statusFilter': 'statusFilter',
            'tableContainer': 'tableContainer',
            'emptyState': 'emptyState',
            'result': 'resultContainer',
            'pagination': 'paginationContainer' // Fixed ID to match HTML
        };

        let missingElements = [];

        for (const [id, prop] of Object.entries(required_elements)) {
            const element = document.getElementById(id);
            if (!element) {
                missingElements.push(id);
                console.error(`‚ùå Element #${id} not found`);
            } else {
                this[prop] = element;
                console.log(`‚úì Found ${id} element`);
            }
        }

        if (missingElements.length > 0) {
            throw new Error(`Missing required elements: ${missingElements.join(', ')}`);
        }
    }

    /**
     * Initialize state variables with enhanced logging
     */
    initializeState() {
        console.log('üîÑ Initializing state variables...');
        
        this.enableLiveUpdate = false;
        this.tableResetEnabled = true;
        this.BackspaceDefault = true;
        this.xmlData = '';
        this.lastSearchTerm = '';
        this.currentStatusFilter = 'all';
        this.lastFilterCategory = 'all';
        this.rowsPerPage = 10;
        this.currentPage = 1;
        this.visibleRowsCount = 0;
        
        console.log('‚úì State variables initialized');
    }

    /**
     * Set up event listeners with error handling
     */
    initializeEventListeners() {
        console.log('üëÇ Setting up event listeners...');

        try {
            this.setupSearchListeners();
            this.setupFilterListeners();
            this.setupPaginationListeners();
            this.setupSorting();
            
            console.log('‚úÖ Event listeners setup complete');
        } catch (error) {
            console.error('‚ùå Error in event listener setup:', error);
            this.showError('Failed to initialize event handlers');
        }
    }

    /**
     * Set up search-related event listeners
     */
    setupSearchListeners() {
        console.log('üîç Setting up search listeners...');

        // Search input events
        this.searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                console.log('‚Ü©Ô∏è Enter key pressed - triggering search');
                this.search();
            }
            if (e.key === 'Backspace' && this.tableResetEnabled) {
                console.log('‚å´ Backspace pressed - handling reset');
                this.handleBackspace();
            }
        });

        // Search button
        const searchBtn = document.getElementById('searchBtn');
        if (searchBtn) {
            searchBtn.addEventListener('click', () => {
                console.log('üîç Search button clicked');
                this.search();
            });
        }
    }

    /**
     * Set up filter-related event listeners
     */
    setupFilterListeners() {
        console.log('üîÑ Setting up filter listeners...');

        // NAR filter
        if (this.narFilter) {
            this.narFilter.addEventListener('change', () => {
                console.log('üìä NAR filter changed:', this.narFilter.value);
                this.applyFilters();
            });
        }

        // Status filter
        if (this.statusFilter) {
            this.statusFilter.addEventListener('change', () => {
                console.log('üîÑ Status filter changed:', this.statusFilter.value);
                this.applyFilters();
            });
        }
    }

    /**
     * Apply all active filters
     */
    applyFilters() {
        console.log('üîÑ Applying filters...');
        
        const searchTerm = this.searchInput.value.toLowerCase();
        const narCategory = this.narFilter.value.toLowerCase();
        const statusFilter = this.statusFilter.value.toLowerCase();
        
        let matchCount = 0;
        
        this.tableBody.querySelectorAll('tr').forEach(row => {
            const narValue = row.getAttribute('data-nar')?.toLowerCase() || '';
            const statusCell = row.querySelector('td[data-field="DD"]');
            const statusValue = statusCell?.textContent.toLowerCase() || '';
            
            const matchesNar = narCategory === 'all' || narValue.includes(narCategory);
            const matchesStatus = statusFilter === 'all' || statusValue.includes(statusFilter);
            const matchesSearch = !searchTerm || Array.from(row.getElementsByTagName('td'))
                .some(cell => cell.textContent.toLowerCase().includes(searchTerm));
            
            const isVisible = matchesNar && matchesStatus && matchesSearch;
            row.style.display = isVisible ? '' : 'none';
            if (isVisible) matchCount++;
        });

        console.log(`‚úì Filters applied: ${matchCount} matches found`);
        this.visibleRowsCount = matchCount;
        this.updateSearchResults(matchCount);
        this.updatePaginationVisibility();
    }

    /**
     * Update search results display
     */
    updateSearchResults(matchCount) {
        console.log('üìä Updating search results display...');
        
        const searchTerm = this.searchInput.value;
        const statusText = this.statusFilter.options[this.statusFilter.selectedIndex].text;
        
        let message = '';
        if (this.currentStatusFilter !== 'all') {
            message = `Showing ${matchCount} ${statusText} records`;
            if (searchTerm) {
                message += ` matching "${searchTerm}"`;
            }
        } else if (searchTerm) {
            message = `Found ${matchCount} results for "${searchTerm}"`;
        }
        
        this.resultContainer.innerHTML = message;
        this.updateTableVisibility(matchCount > 0);
    }

    /**
     * Handle errors and display to user
     */
    showError(message) {
        console.error('‚ùå Error:', message);
        const errorHtml = `
            <div class="alert alert-danger" role="alert">
                <strong>Error:</strong> ${message}
                <br>
                <small>Please check the console for more details.</small>
            </div>
        `;
        this.resultContainer.innerHTML = errorHtml;
        this.resultContainer.style.display = 'block';
    }
}

// Initialize handler with comprehensive error checking
document.addEventListener('DOMContentLoaded', () => {
    console.log('üåü DOM Content Loaded - Starting XMLTableHandler initialization');
    
    try {
        const handler = new XMLTableHandler();
        console.log('‚ú® XMLTableHandler instance created successfully');
    } catch (error) {
        console.error('‚ùå Fatal initialization error:', error);
        // Display error to user
        const errorDiv = document.createElement('div');
        errorDiv.className = 'alert alert-danger mt-3';
        errorDiv.innerHTML = `
            <strong>Initialization Error:</strong> ${error.message}
            <br>
            <small>Please check the console for detailed error information.</small>
        `;
        document.body.insertBefore(errorDiv, document.body.firstChild);
    }
});
    </script>
</body>
</html>
